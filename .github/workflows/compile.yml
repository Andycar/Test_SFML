name: build (Windows/MSVC + SFML)

on:
  workflow_dispatch:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  SZ_SFML_ROOT: tmp/SFML
  _SFML_PACK_NAME: windows-vc17-64.zip
  _SFML_DOWNLOAD_PACK: https://artifacts.sfml-dev.org/by-branch/master/windows-vc17-64.zip
  # NOTE: pkg. layout: ./<commit-hash>/[lib|include|...]
  _SFML_DOWNLOAD_DIR: tmp

  # Configuration type to build.
  # You can convert this to a build matrix if you need coverage of multiple configuration types.
  # https://docs.github.com/actions/learn-github-actions/managing-complex-workflows#using-a-build-matrix
  #BUILD_CONFIGURATION: Release

permissions:
  contents: read

jobs:
  build:
    runs-on: windows-latest
# This is too scrict, e.g. would prevent trying alternate builds etc.:
#    strategy:
#      fail-fast: false
    
    steps:

    - name: Checkout...
      uses: actions/checkout@v3

    - name: Setup MSVC/CLI dev. env.
      uses: ilammy/msvc-dev-cmd@v1.13.0

    - name: Setup SFML...
      shell: cmd
      run: tooling/sfml_dl+unzip

    - name: compile
      run: | 
        cl src\*.cpp /O2 /GL /EHsc /std:c++17 /I %SFML_ROOT%/include/ /link /OUT:bin\main.exe /OPT:REF /OPT:ICF /LTCG /INCREMENTAL:NO /DYNAMICBASE /LIBPATH:%SFML_ROOT%/lib sfml-window.lib sfml-graphics.lib sfml-system.lib


    # - name: Download custom-built full-static SFML pack
    #   shell: cmd
    #   run: tooling\busybox sh tooling/sfml-setup-MSVCRT-static-addon

    